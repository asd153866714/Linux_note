# 實驗：架設 NAT 伺服器

* 準備兩台虛擬機

* 第一台：NAT，僅限主機，內部網路

* 第二台：內部網路，一張網卡

* 設定第二台內部網路的 ip：
  1. `ifconfig enp0s3 192.168.1.2 netmask 255.255.255.0` 舊版方法
  2. `ip addr add 192.168.1.2/24 brd + dev enp0s3` 
 
* `ip addr add 192.168.1.2/24 brd + dev enp0s3` 新增第二組 ip 到同一張網卡
  
* `ifconfig enp0s3 0` 清除網卡的網路設定

* `ip addr show + 網卡名稱` 顯示網卡資訊

* `ip route add default via 192.168.1.1` 新增內定路由

* `ip route show` 顯示路由資訊

* `history` 顯示輸入紀錄
  * `!編號` 輸入

### 第一台虛擬機

* `ip addr add 192.168.1.1/24 brd + dev enp0s9` 設定內部網卡的 ip

* `echo 1 > /proc/sys/net/ipv4/ip_forward` 啟動路由功能

* `iptables -A FORWARD -o enp0s3 -i enp0s9 -s 192.168.1.0/24 -m conntrack --ctstate NEW -j ACCEPT`

* `iptables -A FORWARD -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT`

* `iptables -t nat -A POSTROUTING -o enp0s3 -s 192.168.1.0/24 -j MASQUERADE`

* `echo 1 > /proc/sys/net/ipv4/ip_forward`
